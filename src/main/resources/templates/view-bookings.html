<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>View Existing Booked Cars</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
	<style>
		body {
			min-height: 100vh;
			background: linear-gradient(135deg,
					#ffecd2,
					#fcb69f,
					#a1c4fd,
					#c2e9fb,
					#d4fc79);
			background-attachment: fixed;
		}
		.content-wrapper {
			backdrop-filter: blur(10px);
			background: rgba(255, 255, 255, 0.75);
			border-radius: 15px;
			padding: 25px;
			margin-top: 30px;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
		}

		.hero-section {
			background: linear-gradient(135deg, rgba(13, 110, 253, 0.85), rgba(59, 139, 255, 0.85));
			color: white;
			padding: 60px 20px;
			border-radius: 15px;
			text-align: center;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
		}

		.contact-card {
			border-radius: 15px;
			background: rgba(255, 255, 255, 0.85);
			backdrop-filter: blur(6px);
			transition: transform 0.2s ease-in-out;
		}

		.contact-card:hover {
			transform: translateY(-5px);
		}

		.contact-icon {
			font-size: 2.3rem;
			color: #0d6efd;
		}

		/* Navbar icons */
		.nav-link i {
			color: rgb(255, 128, 64);
			margin-right: 4px;
		}

		/* Page title icon */
		.page-title i {
			color: #0d6efd;
		}

		/* Action icon */
		.btn-update i {
			color: #ffffff;
		}

		/* Info icon (No bookings) */
		.no-data i {
			color: #ff6b6b;
			font-size: 1.3rem;
		}

		/* Table container */
		.table-card {
			background: rgba(255, 255, 255, 0.92);
			border-radius: 14px;
			padding: 16px;
			box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
		}

		/* Table header */
		.table thead th {
			background: linear-gradient(135deg, #0d6efd, #3b8bff);
			color: #ffffff;
			text-align: center;
			vertical-align: middle;
			border: none;
			font-size: 0.9rem;
		}

		/* Table body cells */
		.table tbody td {
			vertical-align: middle;
			text-align: center;
			border-color: #dee2e6;
			font-size: 0.88rem;
		}

		/* Hover effect */
		.table-hover tbody tr:hover {
			background-color: rgba(13, 110, 253, 0.08);
		}

		/* Status badge */
		.badge-booked {
			background: linear-gradient(135deg, #22c55e, #16a34a);
			color: #ffffff;
			padding: 5px 10px;
			border-radius: 999px;
			font-size: 0.75rem;
		}

		/* Update button */
		.btn-update {
			background: linear-gradient(135deg, #f59e0b, #f97316);
			color: white;
			border-radius: 999px;
			border: none;
		}

		.btn-update:hover {
			background: linear-gradient(135deg, #f97316, #ea580c);
		}

		.navbar-custom {
			background: rgba(15, 23, 42, 0.95);
			backdrop-filter: blur(8px);
		}
	</style>
</head>

<body>
	<!-- NAVBAR -->
	<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
		<div class="container">
			<a class="navbar-brand d-flex align-items-center brand-logo" href="/home" aria-label="Surya Car Pool home">
				<!-- Inline SVG logo (kept simple & accessible) -->
				<svg class="brand-svg" viewBox="0 0 64 64" xmlns="/images/logo.png" role="img"
					aria-labelledby="logoTitle logoDesc">
					<title id="logoTitle">Surya Car Pool logo</title>
					<desc id="logoDesc">Sun rising above a road — Surya Car Pool</desc>
					<img src="/images/logo.png" alt="Surya Car Pool"
						style="width:70px; height:70px; border-radius:14px; object-fit:contain;" />
					<rect width="64" height="64" rx="10" fill="url(#g1)" />
					<circle cx="20" cy="18" r="8" fill="#fff5d6" />
					<path d="M6 44 C18 38,46 38,58 44 L58 50 C46 44,18 44,6 50 Z" fill="#0f1724" />
					<g stroke="#ffd166" stroke-width="1.8" stroke-linecap="round">
						<path d="M12 43 L16 43" stroke-dasharray="4 3" />
						<path d="M24 42 L28 42" stroke-dasharray="4 3" />
						<path d="M36 42 L40 42" stroke-dasharray="4 3" />
						<path d="M48 43 L52 43" stroke-dasharray="4 3" />
					</g>
					<path d="M18 36 h10 l3-5 h8 l3 5 h3 v3 h-30 v-3 z" fill="#fff" />
				</svg>

				<div class="d-flex flex-column">
					<span class="brand-title text-white">Surya Car Pool</span>
					<span class="brand-tagline text-white-50">Self Drive Cars Provider</span>
				</div>

				<span class="ms-3 badge bg-white text-dark align-self-start" style="font-weight:600">Trusted</span>
			</a>

			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navMain">
				<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link" href="/home">
							<i class="bi bi-house-door-fill"></i> Home
						</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="/users/ui">
							<i class="bi bi-people-fill"></i> Users
						</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="/rides/ui">
							<i class="bi bi-car-front-fill"></i> Rides
						</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="/bookings/ui">
							<i class="bi bi-journal-check"></i> Bookings
						</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="/aboutus/ui">
							<i class="bi bi-info-circle-fill"></i> About Us
						</a>
					</li>

					<li class="nav-item">
						<a class="nav-link" href="/contactus/ui">
							<i class="bi bi-envelope-fill"></i> Contact Us
						</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="container py-5">

		<h1 class="page-title fw-bold">
			<i class="bi bi-car-front-fill"></i> Manage Booked Cars
		</h1>

		<div class="table-card">
			<div class="table-responsive">
				<table class="table table-bordered table-hover">
					<thead>
						<tr>
							<th>Car ID</th>
							<th>Car Name</th>
							<th>Car Number</th>
							<th>Rent / Day</th>
							<th>Status</th>
							<th>Customer Name</th>
							<th>Pickup Location</th>
							<th>Pickup Date & Time</th>
							<th>Drop Date & Time</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody id="bookingTableBody"></tbody>
				</table>
			</div>
		</div>

		<div id="noBookings" class="no-data d-none">
			<i class="bi bi-info-circle"></i> No bookings found.
		</div>

	</div>

	<script>
		fetch('/api/view-bookings')
			.then(response => response.json())
			.then(data => {
				const tbody = document.getElementById('bookingTableBody');
				const noData = document.getElementById('noBookings');

				if (!data || data.length === 0) {
					noData.classList.remove('d-none');
					return;
				}

				tbody.innerHTML = '';

				data.forEach(b => {
					tbody.innerHTML += `
						<tr>
							<td>${b.carId}</td>
							<td>${b.carName}</td>
							<td>${b.carNumber}</td>
							<td>₹ ${b.perDayRent}</td>
							<td>
								<span class="badge badge-booked">
									${b.status}
								</span>
							</td>
							<td>${b.customerName}</td>
							<td>${b.pickupLocation}</td>
							<td>${b.pickupDateTime?.replace('T', ' ')}</td>
							<td>${b.dropDateTime?.replace('T', ' ')}</td>
							<td>
							    <a href="/bookings/update/${b.carId}"
							       class="btn btn-update btn-sm"
							       onclick="return markAvailable(${b.carId}, this)">
							        <i class="bi bi-pencil-square"></i> Update
							    </a>
							</td>

						</tr>
					`;
				});
			})
			.catch(error => {
				console.error('Error loading bookings:', error);
			});
	</script>
	<script>
		function markAvailable(carId, el) {
			event.preventDefault(); // stops page navigation

			if (!confirm("Mark this car as AVAILABLE?")) {
				return false;
			}

			fetch(`/api/cars/${carId}/status`, {
				method: "PUT",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({status: "AVAILABLE"})
			})
				.then(response => {
					if (!response.ok) {
						throw new Error("Failed to update status");
					}
					return response.json();
				})
				.then(() => {
					// update status badge instantly (UI feedback)
					const row = el.closest("tr");
					const statusCell = row.children[4];

					statusCell.innerHTML = `
		                <span class="badge badge-booked">
		                    AVAILABLE
		                </span>
		            `;

					alert("Car status updated to AVAILABLE");
				})
				.catch(err => {
					console.error(err);
					alert("Error updating car status");
				});

			return false; // ensures link never navigates
		}
	</script>
	<script>
		function markAvailable(carId, el) {
			event.preventDefault(); // stops page navigation

			if (!confirm("Mark this car as AVAILABLE?")) {
				return false;
			}

			fetch(`/api/cars/${carId}/status`, {
				method: "PUT",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({status: "AVAILABLE"})
			})
				.then(response => {
					if (!response.ok) {
						throw new Error("Failed to update status");
					}
					return response.json();
				})
				.then(() => {
					// update status badge instantly (UI feedback)
					const row = el.closest("tr");
					const statusCell = row.children[4];

					statusCell.innerHTML = `
		                <span class="badge badge-booked">
		                    AVAILABLE
		                </span>
		            `;

					alert("Car status updated to AVAILABLE");
				})
				.catch(err => {
					console.error(err);
					alert("Error updating car status");
				});

			return false; // ensures link never navigates
		}
	</script>

	<!-- FOOTER -->
	<footer class="bg-dark text-light mt-5">
		<div class="container py-4 text-center small" style="color: brown;">
			© Surya Car Pool -2025 · All rights reserved
		</div>
		<div class="text-center text-muted small py-2" style="background:rgba(0,0,0,0.04)">
			Need help? Email <a href="mailto:support@suryacarpool.example"
				class="text-muted">support@suryacarpool.example</a> · Terms apply
		</div>
	</footer>
</body>

</html>